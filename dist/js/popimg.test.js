window.TPL=window.TPL||{},TPL.tplmap=TPL.tplmap||{},TPL.getTpl=TPL.getTpl||function(o){return this.tplmap[o]}(function(o){o.tplmap["zadmin-popimg"]='<div class="overlay" style="display: none;"></div><div class="pop-modal"><i class="pop-close iconfont icon-close_m"></i><i class="pop-detail iconfont icon-menu"></i><div class="modal_content"><ul class="pop-list"></ul><img src="##"></div></div>'})(TPL),window.popimg=function(){var o=null,i={},t={spacing:60,beforeShowDetail:function(){}},n={init:function(i){t=$.extend(t,i),o=n.getInstance(),n.initEvent()},initDom:function(){var o=TPL.getTpl("zadmin-popimg");return $("body").append($(o)),{overlay:overlay,modal:modal}},initEvent:function(){$(window).on("resize",function(){n.computePosition()}),$("body").on("click",".preview-photo",function(o){var i=$(o.target).attr("href");return n.showImage(i),!1}),o.overlay.on("click",function(){n.hide()}),$(".pop-close",o.modal).on("click",function(){n.hide()}),$(".pop-detail",o.modal).on("click",function(){if($(".modal_content>.pop-list",o.modal).hasClass("pop-in"))return $(".modal_content>.pop-list",o.modal).removeClass("pop-in").delay(200).animate({top:"-100%"},200),!1;var n=t.beforeShowDetail()||i,a="";for(var e in n)a+="<li>"+e+" :"+n[e]+"</li>";$(".modal_content>.pop-list",o.modal).html(a).animate({top:0},400).addClass("pop-in")})},resetDom:function(){o.modal.removeClass("animate-out")},loadImg:function(){var o=$.Deferred(),t=new Image;return t.src=i.src,t.onload=function(){i.width=t.width,i.height=t.height,i.ratio=t.width/t.height,n.computePosition(),o.resolve()},t.error=function(){o.reject()},o},hide:function(){o.overlay.hide(500,function(){$("body").removeClass("pop-show")}),o.modal.addClass("animate-out").delay(300).removeClass("animate-in"),setTimeout(function(){n.resetDom()},500)},showImage:function(t){i.src=t,o.overlay.show(0,function(){$("body").addClass("pop-show")}),o.modal.show(0).addClass("animate-in"),n.loadImg(t).then(function(){$(".modal_content>img",o.modal).remove(),$(".modal_content",o.modal).append('<img src="'+i.src+'"/>'),console.log(i)},function(){alert("图片加载失败！")})},computePosition:function(){var n=$(window).width(),a=$(window).height(),e=Math.min(n-2*t.spacing,i.width),l=Math.min(a-2*t.spacing,i.height);setL=Math.max(t.spacing,(n-i.width)/2),setT=Math.max(t.spacing,(a-i.height)/2),e/l<i.ratio&&(l=e/i.ratio),e/l>i.ratio&&(e=l*i.ratio),o.modal.css({left:Math.abs(e-n)/2,top:Math.abs(l-a)/2,width:e,height:l})},getInstance:function(){return o?o:o=n.initDom()}};return{init:n.init,showImage:n.showImage,hide:n.hide}}();