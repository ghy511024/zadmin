window.TPL=window.TPL||{},TPL.tplmap=TPL.tplmap||{},TPL.getTpl=TPL.getTpl||function(i){return TPL.tplmap[i]},function(i){i.tplmap["zadmin-popimg"]='<div class="popimg-panel"><div class="popimg-overlay" style="display: none;"></div><div class="popimg-modal"><i class="popimg-close iconfont icon-close_m"></i><i class="popimg-detail iconfont icon-menu"></i><div class="modal_content"><ul class="popimg-list"></ul><img src="" /></div></div><div class="popimg-switcher-row"><i class="popimg-switcher popimg-prev">&lt;</i><i class="popimg-switcher popimg-next">&gt;</i></div></div>'}(TPL),window.popimg=function(){var i=null,t=[],o=0,e=null,n={spacing:60,beforeShowDetail:function(){},errorResolve:function(){}},a={init:function(t){n=$.extend(n,t),i=a.getInstance(),a.initEvent()},initDom:function(){var i=$(TPL.getTpl("zadmin-popimg"));return $("body").append(i),{overlay:i.find(".popimg-overlay"),modal:i.find(".popimg-modal"),switcher:i.find(".popimg-switcher-row")}},initEvent:function(){$(window).on("resize",function(){a.computePosition()}),$("body").on("click",".preview-photo",function(i){var t=$(i.target).attr("data-href");return a.showImage(t),!1}),$(".popimg-close",i.modal).on("click",function(){a.hide()}),i.switcher.on("click",".popimg-prev",function(){a.switchImg(-1)}),i.switcher.on("click",".popimg-next",function(){a.switchImg(1)}),$(".popimg-detail",i.modal).on("click",function(){if($(".modal_content>.popimg-list",i.modal).hasClass("popimg-in"))return $(".modal_content>.popimg-list",i.modal).removeClass("popimg-in").delay(300).animate({top:"-100%"},200),!1;var e=n.beforeShowDetail()||t[o],a="";for(var s in e)"error"!==s&&(a+="<li>"+s+": "+e[s]+"</li>");$(".modal_content>.popimg-list",i.modal).html(a).animate({top:0},400).addClass("popimg-in")})},resetDom:function(){i.modal.removeClass("animate-out animate-in"),i.overlay.removeAttr("style").hide(),i.switcher.hide(),$("body").removeClass("popimg-show"),$(".modal_content>.popimg-list",i.modal).removeAttr("style").removeClass("popimg-in")},loadImg:function(i){var e=$.Deferred(),n=new Image;return n.src=i,n.onload=function(){t[o].width=n.width,t[o].height=n.height,t[o].aspect_ratio=n.width/n.height,t[o].error=!1,a.computePosition(),e.resolve()},n.onerror=function(){e.reject()},e},hide:function(){i.overlay.animate({opacity:0},100,function(){$(this).hide()}),$("body").removeClass("popimg-show"),i.modal.addClass("animate-out").delay(400).removeClass("animate-in"),setTimeout(function(){a.resetDom()},800)},showImage:function(e){if(null===i&&a.init(),void 0===e)return!1;var n=Object.prototype.toString.call(e).slice(8,-1),s=Object.prototype.toString.call(e[0]).slice(8,-1);a.resetDom(),t=[],o=0,a.settleData[n+s](e,function(){i.overlay.show(0,function(){$("body").addClass("popimg-show")}),t.length>1&&i.switcher.fadeIn(),a.settleImage()})},switchImg:function(n){return e?!1:(i.modal.removeClass("animate-in").addClass("fade-out"),void(e=setTimeout(function(){o+=n,0>=o?(i.switcher.find(".popimg-prev").animate({left:"-100%"},200),i.switcher.find(".popimg-next").animate({right:0},200)):o>=t.length-1&&(i.switcher.find(".popimg-next").animate({right:"-100%"},200),i.switcher.find(".popimg-prev").animate({left:0},200)),$(".modal_content>.popimg-list",i.modal).removeAttr("style").removeClass("popimg-in"),a.settleImage(),e=null},250)))},settleData:{StringString:function(i,o){t.push({src:i}),o()},ObjectUndefined:function(i,o){t.push(i),o()},ArrayString:function(i,o){for(var e=0,n=i.length;n>e;e++)t.push({src:i[e]});console.log(t),o()},ArrayObject:function(i,o){for(var e=0,n=i.length;n>e;e++)t.push(i[e]);o()}},settleImage:function(){a.loadImg(t[o].src).then(function(){i.modal.show(0).removeClass("fade-out").addClass("animate-in"),$(".modal_content>img",i.modal).remove(),$(".modal_content",i.modal).append('<img src="'+t[o].src+'"/>')},function(){var i=n.errorResolve();i||(t[o].width=360,t[o].height=240,t[o].aspect_ratio=1.5,t[o].error=!0,a.computePosition())})},computePosition:function(){var e=$(window).width(),a=$(window).height(),s=Math.min(e-2*n.spacing,t[o].width),r=Math.min(a-2*n.spacing,t[o].height);s/r<t[o].aspect_ratio&&(r=s/t[o].aspect_ratio),s/r>t[o].aspect_ratio&&(s=r*t[o].aspect_ratio),i.modal.css({left:Math.abs(s-e)/2,top:Math.abs(r-a)/2,width:s,height:r})},getInstance:function(){return i?i:i=a.initDom()}};return{showImage:a.showImage}}();