window.TPL=window.TPL||{},TPL.tplmap=TPL.tplmap||{},TPL.getTpl=TPL.getTpl||function(o){return TPL.tplmap[o]},function(o){o.tplmap["zadmin-popimg"]='<div class="overlay" style="display: none;"></div><div class="pop-modal"><i class="pop-close iconfont icon-close_m"></i><i class="pop-detail iconfont icon-menu"></i><div class="modal_content"><ul class="pop-list"></ul><img src="http://fengyun-bar.b0.upaiyun.com/1470742916289691.jpg"></div></div>'}(TPL),window.popimg=function(){var o=null,i={},n={spacing:60,beforeShowDetail:function(){}},t={init:function(i){n=$.extend(n,i),o=t.getInstance(),t.initEvent()},initDom:function(){var o=$(TPL.getTpl("zadmin-popimg"));return $("body").append(o),{overlay:o.find(".overlay"),modal:o.find(".pop-modal")}},initEvent:function(){$(window).on("resize",function(){t.computePosition()}),$("body").on("click",".preview-photo",function(o){var i=$(o.target).attr("href");return t.showImage(i),!1}),o.overlay.on("click",function(){t.hide()}),$(".pop-close",o.modal).on("click",function(){t.hide()}),$(".pop-detail",o.modal).on("click",function(){if($(".modal_content>.pop-list",o.modal).hasClass("pop-in"))return $(".modal_content>.pop-list",o.modal).removeClass("pop-in").delay(200).animate({top:"-100%"},200),!1;var t=n.beforeShowDetail()||i,a="";for(var e in t)a+="<li>"+e+" :"+t[e]+"</li>";$(".modal_content>.pop-list",o.modal).html(a).animate({top:0},400).addClass("pop-in")})},resetDom:function(){o.modal.removeClass("animate-out")},loadImg:function(){var o=$.Deferred(),n=new Image;return n.src=i.src,n.onload=function(){i.width=n.width,i.height=n.height,i.ratio=n.width/n.height,t.computePosition(),o.resolve()},n.error=function(){o.reject()},o},hide:function(){o.overlay.hide(500,function(){$("body").removeClass("pop-show")}),o.modal.addClass("animate-out").delay(300).removeClass("animate-in"),setTimeout(function(){t.resetDom()},500)},showImage:function(n){i.src=n,o.overlay.show(0,function(){$("body").addClass("pop-show")}),o.modal.show(0).addClass("animate-in"),t.loadImg(n).then(function(){$(".modal_content>img",o.modal).remove(),$(".modal_content",o.modal).append('<img src="'+i.src+'"/>'),console.log(i)},function(){alert("图片加载失败！")})},computePosition:function(){var t=$(window).width(),a=$(window).height(),e=Math.min(t-2*n.spacing,i.width),l=Math.min(a-2*n.spacing,i.height);setL=Math.max(n.spacing,(t-i.width)/2),setT=Math.max(n.spacing,(a-i.height)/2),e/l<i.ratio&&(l=e/i.ratio),e/l>i.ratio&&(e=l*i.ratio),o.modal.css({left:Math.abs(e-t)/2,top:Math.abs(l-a)/2,width:e,height:l})},getInstance:function(){return o?o:o=t.initDom()}};return{init:t.init,showImage:t.showImage,hide:t.hide}}();